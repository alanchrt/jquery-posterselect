(function(a){a.posterselect={popups:[],counter:0,init_slider:function(c,d){var b=a.posterselect.popups[c];b.slider.init(Math.floor(d));if(b.videoduration){b.videoduration.remove()}}};a.fn.extend({posterselect:function(b){var d={time:"2",conversion_url:"./?time=%s",callback:function(f,e){},posterselect_url:"/",videoduration_swf:"videoduration.swf",videoduration_url:null};var b=a.extend(d,b);var c=function(i){var j=a.extend({},b);var f=this;var h=i.attr("href").split("#");f.callback=j.callback;f.video={url:h[0]};f.grab=function(k){a.get(j.posterselect_url,{url:f.video.url,time:k},function(l){if(l.posterselect.image.url){f.loading.hide();f.image=l.posterselect.image.url;f.preview.attr("src",f.image);f.preview.show()}else{alert("We were unable to grab a poster frame.")}},"json")};f.obj=a("<div></div>").addClass("posterselect");f.obj.css("top",i.offset().top+i.height());f.obj.css("left",i.offset().left);a(document.body).append(f.obj);f.obj.fadeIn();f.close=function(){f.obj.remove()};f.preview=a("<img>").addClass("posterselect-preview");f.preview.hide();f.obj.append(f.preview);f.loading=a("<div></div>").addClass("posterselect-loading");f.loading.html("Loading...");f.loading.hide();f.obj.append(f.loading);f.slider={time:{set:function(k){f.slider.time.value=k;f.slider.indicator.set(k)},value:(h[1])?h[1]:j.time},init:function(k){f.slider.obj=a("<div></div>").addClass("posterselect-slider");f.slider.obj.slider({min:0,max:k,value:f.slider.time.value,slide:function(l,m){f.slider.time.set(m.value)},change:function(l,m){f.slider.time.set(m.value);f.loading.show();f.grab(m.value)}});f.obj.append(f.slider.obj);f.slider.indicator={set:function(l){this.hours=String((l/3600)|0);this.minutes=String((l/60-this.hours*60)|0);this.seconds=String(l%60);if(this.hours.length==1){this.hours="0"+this.hours}if(this.minutes.length==1){this.minutes="0"+this.minutes}if(this.seconds.length==1){this.seconds="0"+this.seconds}this.obj.html("<strong>Position:</strong> "+this.hours+":"+this.minutes+":"+this.seconds)},obj:a("<div></div>").addClass("posterselect-indicator")};f.slider.indicator.set(f.slider.time.value);f.obj.append(f.slider.indicator.obj);f.ok=a("<a></a>").addClass("posterselect-ok");f.ok.html("Ok");f.ok.addClass("ui-widget-content");f.ok.attr("href","#ok");f.ok.click(function(l){l.preventDefault();f.close();var m=i.attr("href").split("#")[0]+"#"+f.slider.time.value;i.attr("href",m);f.callback(f.image,f.slider.time.value)});f.obj.append(f.ok);f.cancel=a("<a></a>").addClass("posterselect-cancel");f.cancel.html("Cancel");f.cancel.attr("href","#cancel");f.cancel.click(function(l){l.preventDefault();f.close()});f.obj.append(f.cancel)}};if(j.videoduration_url){var g=a.posterselect.counter;a.get(j.videoduration_url,{url:f.video.url},function(k){a.posterselect.init_slider(g,k.videoduration.video.duration)},"json")}else{var e="url="+escape(f.video.url)+"&callback=jQuery.posterselect.init_slider&index="+a.posterselect.counter;f.videoduration=a("<object></object");f.videoduration.attr("classid","clsid:d27cdb6e-ae6d-11cf-96b8-444553540000");f.videoduration.attr("codebase","http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=10,0,0,0");f.videoduration.attr("width","1");f.videoduration.attr("height","1");f.videoduration.append(a("<param>").attr("name","movie").attr("value",j.videoduration_swf));f.videoduration.append(a("<param>").attr("name","allowScriptAccess").attr("value","always"));f.videoduration.append(a("<param>").attr("name","flashVars").attr("value",e));f.videoduration.append(a("<embed>").attr("type","application/x-shockwave-flash").attr("src",j.videoduration_swf).attr("width","1").attr("height","1").attr("flashvars",e));a(document.body).append(f.videoduration)}f.grab(f.slider.time.value)};return this.each(function(){var f=a.extend({},b);var e=a(this);e.click(function(h){h.preventDefault();var g=a(this).data("popup");if(!g||g.obj.is(":hidden")){var g=new c(a(this));a(this).data("popup",g);a.posterselect.popups[a.posterselect.counter++]=g}else{g.close()}})})}})})(jQuery);