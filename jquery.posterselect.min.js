(function(a){a.posterselect={popups:[],counter:0,init_slider:function(c,d){var b=a.posterselect.popups[c];b.slider.init(Math.floor(d));b.videoduration.remove()}};a.fn.extend({posterselect:function(b){var d={time:"2",conversion_url:"./?time=%s",callback:function(f,e){},posterselect_url:"/",videoduration_swf:"videoduration.swf",videoduration_url:"/"};var b=a.extend(d,b);var c=function(h){var i=a.extend({},b);var f=this;var g=h.attr("href").split("#");f.callback=i.callback;f.video={url:g[0]};f.grab=function(j){a.get(i.posterselect_url,{url:f.video.url,time:j},function(k){if(k.posterselect.image.url){f.loading.hide();f.image=k.posterselect.image.url;f.preview.attr("src",f.image);f.preview.show()}else{alert("We were unable to grab a poster frame.")}},"json")};f.obj=a("<div></div>").addClass("posterselect");f.obj.css("top",h.offset().top+h.height());f.obj.css("left",h.offset().left);a(document.body).append(f.obj);f.obj.fadeIn();f.close=function(){f.obj.remove()};f.preview=a("<img>").addClass("posterselect-preview");f.preview.hide();f.obj.append(f.preview);f.loading=a("<div></div>").addClass("posterselect-loading");f.loading.html("Loading...");f.loading.hide();f.obj.append(f.loading);f.slider={time:{set:function(j){f.slider.time.value=j;f.slider.indicator.set(j)},value:(g[1])?g[1]:i.time},init:function(j){f.slider.obj=a("<div></div>").addClass("posterselect-slider");f.slider.obj.slider({min:0,max:j,value:f.slider.time.value,slide:function(k,l){f.slider.time.set(l.value)},change:function(k,l){f.slider.time.set(l.value);f.loading.show();f.grab(l.value)}});f.obj.append(f.slider.obj);f.slider.indicator={set:function(k){this.hours=String((k/3600)|0);this.minutes=String((k/60-this.hours*60)|0);this.seconds=String(k%60);if(this.hours.length==1){this.hours="0"+this.hours}if(this.minutes.length==1){this.minutes="0"+this.minutes}if(this.seconds.length==1){this.seconds="0"+this.seconds}this.obj.html("<strong>Position:</strong> "+this.hours+":"+this.minutes+":"+this.seconds)},obj:a("<div></div>").addClass("posterselect-indicator")};f.slider.indicator.set(f.slider.time.value);f.obj.append(f.slider.indicator.obj);f.ok=a("<a></a>").addClass("posterselect-ok");f.ok.html("Ok");f.ok.addClass("ui-widget-content");f.ok.attr("href","#ok");f.ok.click(function(k){k.preventDefault();f.close();f.callback(f.image,f.slider.time.value)});f.obj.append(f.ok);f.cancel=a("<a></a>").addClass("posterselect-cancel");f.cancel.html("Cancel");f.cancel.attr("href","#cancel");f.cancel.click(function(k){k.preventDefault();f.close()});f.obj.append(f.cancel)}};var e="url="+escape(f.video.url)+"&callback=jQuery.posterselect.init_slider&index="+a.posterselect.counter;f.videoduration=a("<object></object");f.videoduration.attr("classid","clsid:d27cdb6e-ae6d-11cf-96b8-444553540000");f.videoduration.attr("codebase","http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=10,0,0,0");f.videoduration.attr("width","1");f.videoduration.attr("height","1");f.videoduration.append(a("<param>").attr("name","movie").attr("value",i.videoduration_swf));f.videoduration.append(a("<param>").attr("name","allowScriptAccess").attr("value","always"));f.videoduration.append(a("<param>").attr("name","flashVars").attr("value",e));f.videoduration.append(a("<embed>").attr("type","application/x-shockwave-flash").attr("src",i.videoduration_swf).attr("width","1").attr("height","1").attr("flashvars",e));a(document.body).append(f.videoduration);f.grab(f.slider.time.value)};return this.each(function(){var f=a.extend({},b);var e=a(this);e.click(function(h){h.preventDefault();var g=a(this).data("popup");if(!g||g.obj.is(":hidden")){var g=new c(a(this));a(this).data("popup",g);a.posterselect.popups[a.posterselect.counter++]=g}else{g.close()}})})}})})(jQuery);